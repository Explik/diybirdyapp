spec:
  name: diy-birdy-app

  static_sites:
  - name: frontend
    source_dir: web
    github:
      branch: master
      deploy_on_push: true
      repo: Explik/diybirdyapp
    
    build_command: npm install && npm run build
    output_dir: dist/diy-birdy-app/browser
    
    index_document: index.html
    error_document: index.html
    
  services:
  - name: backend
    dockerfile_path: api/Dockerfile
    github:
      branch: master
      deploy_on_push: true
      repo: Explik/diybirdyapp

    envs:
      - key: SPRING_PROFILES_ACTIVE
        value: dev
        scope: RUN_TIME
        type: GENERAL
      - key: GREMLIN_HOST
        value: ${gremlin-server.HOSTNAME}
        scope: RUN_TIME
        type: GENERAL
      - key: GREMLIN_PORT
        value: "8182"
        scope: RUN_TIME
        type: GENERAL
      - key: GREMLIN_USERNAME
        value: gremlin
        scope: RUN_TIME
        type: GENERAL
      - key: GREMLIN_PASSWORD
        value: gremlin
        scope: RUN_TIME
        type: SECRET

  workers:
  - name: gremlin-server
    image:
      registry_type: DOCKER_HUB
      repository: tinkerpop/gremlin-server
      tag: "3.7.0"
    
    envs:
      - key: GREMLIN_SERVER_USER
        value: gremlin
        scope: RUN_TIME
        type: GENERAL
      - key: GREMLIN_SERVER_PASSWORD
        value: gremlin
        scope: RUN_TIME
        type: SECRET

  ingress:
    rules:
      - match:
          path:
            prefix: /api
        component:
          name: backend
          preserve_path_prefix: true
      
      - match:
          path:
            prefix: /
        component:
          name: frontend